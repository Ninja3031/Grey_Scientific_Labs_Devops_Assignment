# Nginx Reverse Proxy Configuration
# Acts as an API Gateway / Ingress for frontend and backend
# services running in Docker containers.

events {
    # Event configuration kept minimal for demo purposes
}

http {

    # Backend service load balancer
    # Uses least connections strategy for better load distribution
    upstream backend_cluster {
        least_conn;
        server backend:8080;
    }

    # Frontend service load balancer
    upstream frontend_cluster {
        least_conn;
        server frontend:3000;
    }

    # Public facing Nginx server
    server {
        listen 80;

        # Routes API traffic to backend service
        # Acts as an API Gateway
        location /api/ {
            proxy_pass http://backend_cluster;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Routes UI traffic to frontend service
        location / {
            # This route becomes active only when the frontend service/container
            # is running and reachable via the frontend_cluster upstream.
            # Currently kept for completeness to demonstrate default routing
            # behavior in an API Gateway / Reverse Proxy setup.
   
            proxy_pass http://frontend_cluster;
        }

        # Production Enhancements (not implemented):
        # - TLS / HTTPS termination
        # - Rate limiting
        # - Authentication & Authorization
        # - Web Application Firewall (WAF)
    }
}